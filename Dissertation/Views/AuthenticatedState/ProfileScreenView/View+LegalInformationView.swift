import SwiftUI

extension View {
    /// Show Legal Information Alert
    func showLegalInformationAlert(
        isPresented: Binding<Bool>
    ) -> some View {
        ZStack {
            self
            if isPresented.wrappedValue {
                LegalInformationOverlay(isShowing: isPresented)
                    .animation(.smooth, value: isPresented.wrappedValue)
            }
        }
    }
}

struct LegalInformationOverlay: View {
   @Binding var isShowing: Bool
   @State private var selectedSection: LegalSection? = nil
   
   enum LegalSection: String, CaseIterable {
       case terms = "Terms of Service"
       case privacy = "Privacy Policy"
       case about = "About FundBud"
   }
   
   var body: some View {
       ZStack {
           Color.black.opacity(Constraint.Opacity.medium).ignoresSafeArea()
           Rectangle()
               .fill(.ultraThinMaterial.opacity(Constraint.Opacity.medium))
               .ignoresSafeArea()
               .onTapGesture {
                   HapticManager.shared.trigger(.cancel)
                   isShowing = false
               }

           VStack(spacing: .zero) {
               if let selectedSection = selectedSection {
                   // Document Header with Back Button
                   HStack(alignment: .lastTextBaseline) {
                       Button {
                           HapticManager.shared.trigger(.navigation)
                           withAnimation {
                               self.selectedSection = nil
                           }
                       } label: {
                           Image(systemName: "chevron.left")
                               .renderingMode(.template)
                               .bold()
                               .foregroundColor(.customBurgundy)
                       }
                       
                       Spacer()
                       
                       CustomNavigationBarTitleView(title: createTitle(selectedSection.rawValue))
                       
                       Spacer()
                       
                       Button {
                           HapticManager.shared.trigger(.cancel)
                           isShowing = false
                       } label: {
                           Image(systemName: "xmark.circle.fill")
                               .foregroundColor(.customRichBlack.opacity(Constraint.Opacity.high))
                               .font(.title2)
                       }
                       
                   }
                   .padding(Constraint.padding)
                   .background(Color.customWhiteSand)
                   
                   // Document Content
                   ScrollView {
                       CustomTextView(
                           getContent(for: selectedSection),
                           font: .labelLarge,
                           color: .customRichBlack,
                           alignment: .leading
                       )
                       .padding(Constraint.padding)
                   }
                   .background(Color.customWhiteSand)
                   
               } else {
                   // Main Header
                   HStack(alignment: .lastTextBaseline) {
                       CustomNavigationBarTitleView(title: createTitle("Legal Information"))
                       Spacer()
                       Button {
                           HapticManager.shared.trigger(.cancel)
                           isShowing = false
                       } label: {
                           Image(systemName: "xmark.circle.fill")
                               .foregroundColor(.customRichBlack.opacity(Constraint.Opacity.medium))
                               .font(.title2)
                       }
                   }
                   .padding(Constraint.padding)
                   .background(Color.customWhiteSand)
                   
                   // Menu View
                   VStack(spacing: .zero) {
                       ForEach(LegalSection.allCases, id: \.self) { section in
                           Button {
                               HapticManager.shared.trigger(.navigation)
                               withAnimation {
                                   selectedSection = section
                               }
                           } label: {
                               HStack(alignment: .bottom) {
                                   CustomTextView(
                                       section.rawValue,
                                       font: .bodySmall,
                                       color: .customRichBlack
                                   )
                                   Spacer()
                                   Image(systemName: "chevron.right")
                                       .foregroundColor(.customRichBlack.opacity(0.4))
                               }
                               .padding()
                               .background(Color.white)
                           }
                           
                           if section != LegalSection.allCases.last {
                               Divider()
                           }
                       }
                   }
               }
           }
           .background(Color.customWhiteSand)
           .cornerRadius(Constraint.cornerRadius)
           .padding(Constraint.regularPadding)
           .shadow(
            color: .customRichBlack.opacity(Constraint.Opacity.medium),
            radius: Constraint.shadowRadius
           )
       }
       .onAppear {
           HapticManager.shared.trigger(.notification)
       }
   }
   
    private func getContent(for section: LegalSection) -> String {
        switch section {
        case .terms:
            return """
            TERMS & CONDITIONS
            
            Last updated: \(getCurrentYear())
            
            WHAT IS THIS APP?
            This is a personal expense tracker that helps you manage your spending. By using this app, you agree to these terms.
            
            WHAT YOU CAN DO
            ‚Ä¢ Track your expenses and income
            ‚Ä¢ Set spending budgets
            ‚Ä¢ Take photos of receipts
            ‚Ä¢ Export your data anytime
            ‚Ä¢ Use all features for personal use
            
            WHAT YOU CAN'T DO
            ‚Ä¢ Share false information
            ‚Ä¢ Use the app for illegal activities
            ‚Ä¢ Try to break or hack the app
            ‚Ä¢ Sell or redistribute the app
            
            YOUR DATA
            ‚Ä¢ Everything stays on your device
            ‚Ä¢ We don't see or store your financial data
            ‚Ä¢ Camera is only used for receipts
            ‚Ä¢ You own and control all your information
            
            LEGAL SIDE
            ‚Ä¢ App provided "as is" - we can't guarantee it's perfect
            ‚Ä¢ Not financial advice - make your own money decisions
            ‚Ä¢ We're not responsible if you lose money
            ‚Ä¢ These terms can change (we'll let you know)
            
            üìß QUESTIONS?
            Contact us: fundBud2025@gmail.com
            
            Thanks for using our app responsibly! üôè
            """

        case .privacy:
            return """
            PRIVACY POLICY
            
            Last updated: \(getCurrentYear())
            
            WE PROTECT YOUR PRIVACY
            Your financial data is personal. Here's exactly how we handle it.
            
            WHAT WE COLLECT
            On Your Device Only:
            ‚Ä¢ Your expense amounts and notes
            ‚Ä¢ Budget limits you set
            ‚Ä¢ Receipt photos you take
            ‚Ä¢ Categories you choose
            
            Anonymous Usage Data:
            ‚Ä¢ How often features are used
            ‚Ä¢ Crash reports (no personal data)
            ‚Ä¢ App performance metrics
            
            WHERE YOUR DATA LIVES
            ‚Ä¢ Everything stays on YOUR device
            ‚Ä¢ Nothing uploaded to our servers
            ‚Ä¢ No cloud storage of personal data
            ‚Ä¢ You delete it, it's gone forever
            
            CAMERA ACCESS
            ‚Ä¢ Only used when you scan receipts
            ‚Ä¢ Photos saved to your device only
            ‚Ä¢ You can delete photos anytime
            ‚Ä¢ We never access your photo library
            
            WHAT WE DON'T DO
            ‚Ä¢ Sell your data (never!)
            ‚Ä¢ Share with advertisers
            ‚Ä¢ Read your financial information
            ‚Ä¢ Track you across other apps
            
            KIDS
            This app isn't for children under 13.
            
            YOUR RIGHTS
            ‚Ä¢ See all your data (it's in the app!)
            ‚Ä¢ Export everything anytime
            ‚Ä¢ Delete all data by uninstalling
            ‚Ä¢ Ask us questions about privacy
            
            PRIVACY QUESTIONS?
            Contact us: fundBud2025@gmail
            
            Your trust means everything to us! üîê
            """

        case .about:
            return """
            ABOUT FUNDBUD
            
            Version \(getAppVersion()) ‚Ä¢ Made with ‚ù§Ô∏è
            
            OUR MISSION
            Make expense tracking so simple, you'll actually do it every day.
            
            WHAT MAKES US SPECIAL
            
            Privacy First:
            ‚Ä¢ Everything stays on your device
            ‚Ä¢ No accounts or sign-ups needed
            ‚Ä¢ Your data belongs to you
            
            Lightning Fast:
            ‚Ä¢ Add expenses in seconds
            ‚Ä¢ Quick amounts: ¬£1, ¬£2, ¬£5, ¬£10
            ‚Ä¢ Home screen widget support
            ‚Ä¢ Instant receipt scanning
            
            Smart & Simple:
            ‚Ä¢ Beautiful, easy interface
            ‚Ä¢ Helpful spending insights
            ‚Ä¢ Budget tracking that works
            ‚Ä¢ Works offline always
            
            BUILT WITH
            ‚Ä¢ Swift & SwiftUI
            ‚Ä¢ Advanced haptic feedback
            ‚Ä¢ iOS 16+ optimized
            ‚Ä¢ Accessibility focused
            
            FOR EVERYONE
            ‚Ä¢ VoiceOver support
            ‚Ä¢ Dynamic text sizing
            ‚Ä¢ High contrast modes
            ‚Ä¢ Simple, clear navigation
            
            COMING SOON
            ‚Ä¢ Better Notifications
            ‚Ä¢ Apple Watch app
            ‚Ä¢ More currencies
            ‚Ä¢ Advanced reports
            ‚Ä¢ Even better widgets
            
            üíå GET IN TOUCH
            
            Love the app? Found a bug? Need help? Tell us!
            fundBud2025@gmail
            
            üèÜ THANK YOU
            To everyone who uses this app - you're helping us build something amazing while keeping your privacy intact.
            
            üì± REQUIREMENTS
            ‚Ä¢ iPhone with iOS 16+
            ‚Ä¢ Works on all screen sizes
            ‚Ä¢ iPad compatible
            ‚Ä¢ Dark & Light mode
            
            ¬© \(getCurrentYear()) FundBud
            Made in the UK üá¨üáß
            """
        }
    }

    // MARK: - Helper Functions
    private func getCurrentYear() -> String {
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyy"
        return formatter.string(from: Date())
    }

    private func getAppVersion() -> String {
        return Bundle.main.infoDictionary?["CFBundleShortVersionString"] as? String ?? "1.0"
    }
    
    private func createTitle(_ text: String) -> AttributedString {
        var title = AttributedString(text)
        title.foregroundColor = .customRichBlack
        title.font = TextFonts.titleSmallBold.font
        return title
    }
}
